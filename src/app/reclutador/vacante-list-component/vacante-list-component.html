<div class="page-wrapper">
  <!-- Panel de Filtros -->
  <div class="filtros-container" [class.expanded]="mostrarFiltros">
    <div class="filtros-header">
      <div class="filtros-title">
        <h3>Filtros de vacantes</h3>
        <span class="badge-filtros" *ngIf="hayFiltrosActivos()">{{ hayFiltrosActivos() ? 'Activos' : '' }}</span>
      </div>
      <button class="btn-toggle-filtros" (click)="toggleFiltros()">
        {{ mostrarFiltros ? '‚ñ≤ Ocultar' : '‚ñº Mostrar filtros' }}
      </button>
    </div>

    <div class="filtros-content" *ngIf="mostrarFiltros">
      <div class="filtros-grid">
        <!-- T√≠tulo -->
        <div class="filtro-item">
          <label for="titulo">T√≠tulo del puesto</label>
          <input
            type="text"
            id="titulo"
            [(ngModel)]="filtros.titulo"
            placeholder="Ej: Desarrollador, Contador..."
            class="input-filtro">
        </div>

        <!-- Empresa -->
        <div class="filtro-item">
          <label for="empresa">Empresa</label>
          <input
            type="text"
            id="empresa"
            [(ngModel)]="filtros.empresa"
            placeholder="Nombre de la empresa"
            class="input-filtro">
        </div>

        <!-- Estado -->
        <div class="filtro-item">
          <label for="estado">Estado</label>
          <select
            id="estado"
            [(ngModel)]="filtros.estado"
            class="select-filtro">
            <option value="">Todos</option>
            <option value="ACTIVA">Activa</option>
            <option value="INACTIVA">Inactiva</option>
            <option value="CERRADA">Cerrada</option>
            <option value="CANCELADA">Cancelada</option>
          </select>
        </div>

        <!-- √Årea -->
        <div class="filtro-item">
          <label for="area">√Årea</label>
          <select
            id="area"
            [(ngModel)]="filtros.area"
            class="select-filtro">
            <option value="">Todas</option>
            <option *ngFor="let area of areas" [value]="area.nombre">{{ area.nombre }}</option>
          </select>
        </div>
      </div>

      <div class="filtros-acciones">
        <button
          class="btn-aplicar"
          (click)="aplicarFiltros()">
          ‚úì Aplicar filtros
        </button>
        <button
          class="btn-limpiar"
          (click)="limpiarFiltros()"
          [disabled]="!hayFiltrosActivos()">
          ‚úï Limpiar filtros
        </button>
      </div>
    </div>
  </div>

  <!-- Contenedor principal -->
  <div class="home-container">
    <!-- Lista de vacantes -->
    <div class="lista-vacantes">
      <div class="lista-header">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h3>Gesti√≥n de Vacantes</h3>
            <p class="total-vacantes">{{ vacantes.length }} {{ vacantes.length === 1 ? 'vacante' : 'vacantes' }}</p>
          </div>
          <button class="btn btn-primary btn-nueva-vacante" (click)="abrirModalNuevaVacante()">
            <i class="bi bi-plus-circle"></i> Nueva Vacante
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2 text-muted">Cargando vacantes...</p>
      </div>

      <!-- Error -->
      <div *ngIf="error && !loading" class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ error }}
        <button type="button" class="btn-close" (click)="error = ''"></button>
      </div>

      <!-- Lista de vacantes -->
      <div *ngIf="!loading && vacantes.length > 0">
        <div
          class="vacante-card"
          *ngFor="let vacante of vacantes"
          [class.selected]="vacante.id === vacanteEditando?.id"
          (click)="seleccionarVacante(vacante)">
          <div class="card-header">
            <h4>{{ vacante.titulo }}</h4>
            <span class="match-badge" [class]="getEstadoBadgeClass(vacante.estado)">
              {{ getEstadoTexto(vacante.estado) }}
            </span>
          </div>
          <p class="empresa"><strong>{{ vacante.empresa }}</strong></p>
          <div class="card-info">
            <span class="info-item">üìç {{ vacante.ubicacion }}</span>
            <span class="info-item">üíº {{ vacante.tipoContrato }}</span>
            <span class="info-item">üè¢ {{ vacante.area?.nombre || 'No especificado' }}</span>
          </div>

          <!-- Habilidades -->
          <div *ngIf="vacante.habilidades && vacante.habilidades.length > 0" class="mb-2">
            <div class="habilidades-mini">
              <span *ngFor="let habilidad of vacante.habilidades.slice(0, 3)"
                    class="badge bg-info me-1">
                {{ habilidad.nombre }}
              </span>
              <span *ngIf="vacante.habilidades.length > 3" class="text-muted">
                +{{ vacante.habilidades.length - 3 }} m√°s
              </span>
            </div>
          </div>

          <div class="card-footer">
            <span class="salario">${{ vacante.salario | number }}</span>
            <span class="horas">{{ vacante.horasPorSemana || 40 }} hrs/sem</span>
          </div>

          <!-- Botones de acci√≥n -->
          <div class="card-actions mt-3 pt-3 border-top">
            <div class="d-flex gap-2 flex-wrap">
              <button class="btn btn-outline-primary btn-sm"
                      (click)="abrirModalEditarVacante(vacante); $event.stopPropagation()">
                <i class="bi bi-pencil"></i> Editar
              </button>
              <button *ngIf="vacante.estado === 'ACTIVA'"
                      class="btn btn-outline-warning btn-sm"
                      (click)="cambiarEstado(vacante, 'INACTIVA'); $event.stopPropagation()">
                <i class="bi bi-pause"></i> Pausar
              </button>
              <button *ngIf="vacante.estado === 'INACTIVA'"
                      class="btn btn-outline-success btn-sm"
                      (click)="cambiarEstado(vacante, 'ACTIVA'); $event.stopPropagation()">
                <i class="bi bi-play"></i> Activar
              </button>
              <button class="btn btn-outline-danger btn-sm"
                      (click)="eliminarVacante(vacante.id!); $event.stopPropagation()">
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && vacantes.length === 0" class="text-center py-5">
        <i class="bi bi-briefcase display-1 text-muted"></i>
        <h4 class="text-muted mt-3">No hay vacantes registradas</h4>
        <p class="text-muted">Comienza creando tu primera vacante</p>
        <button class="btn btn-primary" (click)="abrirModalNuevaVacante()">
          <i class="bi bi-plus-circle"></i> Crear Primera Vacante
        </button>
      </div>
    </div>

    <!-- PANEL DE DETALLES - UNA SOLA VERSI√ìN -->
<div class="detalle-vacante" *ngIf="vacantes.length > 0; else emptyState">
  <div class="detalle-scroll">
    <!-- Mostrar vacante seleccionada o la m√°s reciente -->
    <div *ngIf="(vacanteEditando && isEditMode) ? vacanteEditando : getVacanteMasReciente() as vacanteActual">

      <div class="detalle-header">
        <div class="header-content">
          <h2>{{ vacanteActual.titulo }}</h2>
          <p class="empresa-detalle">{{ vacanteActual.empresa }}</p>
          <div class="location-info">
            <span>üìç {{ vacanteActual.ubicacion }}</span>
            <span class="modalidad-tag" *ngIf="vacanteActual.modalidad?.nombre; else noModalidad">
              {{ vacanteActual.modalidad.nombre }}
            </span>
            <ng-template #noModalidad>
              <span class="modalidad-tag text-muted">Por definir</span>
            </ng-template>
          </div>
        </div>
        <div class="match-circle" [class]="getEstadoBadgeClass(vacanteActual.estado)">
          <span class="match-percentage">{{ getEstadoTexto(vacanteActual.estado) }}</span>
          <span class="match-label">Estado</span>
        </div>
      </div>

      <!-- Informaci√≥n extendida -->
      <div class="info-grid-extended">
        <div class="info-card">
          <span class="info-label">Salario mensual</span>
          <span class="info-value">${{ vacanteActual.salario | number }}</span>
        </div>
        <div class="info-card">
          <span class="info-label">Horas semanales</span>
          <span class="info-value">{{ vacanteActual.horasPorSemana || 40 }} hrs</span>
        </div>
        <div class="info-card">
          <span class="info-label">Tipo de contrato</span>
          <span class="info-value">{{ vacanteActual.tipoContrato || 'Por definir' }}</span>
        </div>
        <div class="info-card">
          <span class="info-label">Solicitudes permitidas</span>
          <span class="info-value">{{ vacanteActual.solicitudesPermitidas || 50 }}</span>
        </div>
        <div class="info-card">
          <span class="info-label">√Årea profesional</span>
          <span class="info-value" *ngIf="vacanteActual.area?.nombre; else noArea">
            {{ vacanteActual.area.nombre }}
          </span>
          <ng-template #noArea>
            <span class="info-value text-muted">Por definir</span>
          </ng-template>
        </div>
        <div class="info-card">
          <span class="info-label">Modalidad</span>
          <span class="info-value" *ngIf="vacanteActual.modalidad?.nombre; else noModalidadInfo">
            {{ vacanteActual.modalidad.nombre }}
          </span>
          <ng-template #noModalidadInfo>
            <span class="info-value text-muted">Por definir</span>
          </ng-template>
        </div>
      </div>

      <!-- Horario de trabajo -->
      <div class="seccion" *ngIf="vacanteActual.horaInicio || vacanteActual.horaFin || vacanteActual.diasLaborales || vacanteActual.turno">
        <h3>Horario de Trabajo</h3>
        <div class="horario-info">
          <div *ngIf="vacanteActual.horaInicio && vacanteActual.horaFin" class="horario-item">
            <span class="horario-label">Horario:</span>
            <span class="horario-value">{{ vacanteActual.horaInicio }} - {{ vacanteActual.horaFin }}</span>
          </div>
          <div *ngIf="vacanteActual.diasLaborales" class="horario-item">
            <span class="horario-label">D√≠as laborales:</span>
            <span class="horario-value">{{ vacanteActual.diasLaborales }}</span>
          </div>
          <div *ngIf="vacanteActual.turno" class="horario-item">
            <span class="horario-label">Turno:</span>
            <span class="horario-value">{{ vacanteActual.turno }}</span>
          </div>
          <div *ngIf="vacanteActual.horarioFlexible" class="horario-item">
            <span class="horario-label badge bg-success">Horario flexible</span>
          </div>
          <div *ngIf="!vacanteActual.horaInicio && !vacanteActual.diasLaborales && !vacanteActual.turno" class="horario-item">
            <span class="text-muted">Informaci√≥n de horario por definir</span>
          </div>
        </div>
      </div>

      <!-- Descripci√≥n -->
      <div class="seccion" *ngIf="vacanteActual.descripcion">
        <h3>Descripci√≥n del puesto</h3>
        <p class="texto-descripcion">{{ vacanteActual.descripcion }}</p>
      </div>

      <!-- Habilidades -->
      <div class="seccion" *ngIf="vacanteActual.habilidades && vacanteActual.habilidades.length > 0; else noHabilidades">
        <h3>Habilidades requeridas</h3>
        <div class="tags-container">
          <span *ngFor="let habilidad of vacanteActual.habilidades"
                class="tag tag-match">
            {{ habilidad.nombre }}
          </span>
        </div>
      </div>
      <ng-template #noHabilidades>
        <div class="seccion">
          <h3>Habilidades requeridas</h3>
          <p class="text-muted">No se han especificado habilidades para este puesto</p>
        </div>
      </ng-template>

      <!-- Idiomas -->
      <div class="seccion" *ngIf="vacanteActual.idiomas && vacanteActual.idiomas.length > 0; else noIdiomas">
        <h3>Idiomas requeridos</h3>
        <div class="tags-container">
          <span *ngFor="let idioma of vacanteActual.idiomas"
                class="tag tag-match">
            {{ idioma.idioma }}
          </span>
        </div>
      </div>
      <ng-template #noIdiomas>
        <div class="seccion">
          <h3>Idiomas requeridos</h3>
          <p class="text-muted">No se han especificado idiomas para este puesto</p>
        </div>
      </ng-template>

      <!-- Beneficios -->
      <div class="seccion" *ngIf="vacanteActual.beneficios; else noBeneficios">
        <h3>Beneficios adicionales</h3>
        <p class="texto-descripcion">{{ vacanteActual.beneficios }}</p>
      </div>
      <ng-template #noBeneficios>
        <div class="seccion">
          <h3>Beneficios adicionales</h3>
          <p class="text-muted">No se han especificado beneficios adicionales</p>
        </div>
      </ng-template>

      <!-- Fecha de expiraci√≥n -->
      <div class="seccion" *ngIf="vacanteActual.fechaExpiracion">
        <h3>Vigencia de la vacante</h3>
        <div class="fecha-expiracion">
          <span class="fecha-label">Fecha de expiraci√≥n:</span>
          <span class="fecha-value">{{ vacanteActual.fechaExpiracion | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="botones-footer">
        <button class="btn btn-primary" (click)="abrirModalEditarVacante(vacanteActual)">
          <i class="bi bi-pencil"></i> Editar Vacante
        </button>
        <button class="btn btn-outline-secondary"
                (click)="cambiarEstado(vacanteActual, vacanteActual.estado === 'ACTIVA' ? 'INACTIVA' : 'ACTIVA')">
          <i class="bi" [class]="vacanteActual.estado === 'ACTIVA' ? 'bi-pause' : 'bi-play'"></i>
          {{ vacanteActual.estado === 'ACTIVA' ? 'Pausar' : 'Activar' }}
        </button>
        <button class="btn btn-outline-danger"
                (click)="eliminarVacante(vacanteActual.id!)">
          <i class="bi bi-trash"></i> Eliminar
        </button>
      </div>

      <!-- Mensaje informativo cuando se muestra la vacante m√°s reciente -->
      <div class="alert alert-info mt-4" *ngIf="!vacanteEditando || !isEditMode">
        <i class="bi bi-info-circle me-2"></i>
        Esta es la vacante m√°s reciente. Haz clic en cualquier vacante de la lista para ver sus detalles.
      </div>
    </div>
  </div>
</div>

    <!-- Empty State Template -->
    <ng-template #emptyState>
      <div class="detalle-vacante empty-state">
        <div class="empty-content">
          <div class="empty-icon">üìã</div>
          <h3>Gesti√≥n de Vacantes</h3>
          <p>Selecciona una vacante para ver sus detalles o crea una nueva</p>
          <button class="btn btn-primary mt-3" (click)="abrirModalNuevaVacante()">
            <i class="bi bi-plus-circle"></i> Crear Nueva Vacante
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</div>

<!-- Modal para crear/editar vacante -->
<app-vacante-form-modal
  [show]="showModal"
  [vacante]="vacanteEditando"
  [isEdit]="isEditMode"
  (close)="cerrarModal()"
  (guardado)="onVacanteGuardada()">
</app-vacante-form-modal>
