<div class="modal-backdrop" [class.show]="show" (click)="onBackdropClick($event)">
  <div class="modal-content" [class.show]="show">
    <div class="modal-header">
      <h3 class="modal-title">
        <i class="bi bi-briefcase me-2"></i>
        {{ isEdit ? 'Editar Vacante' : 'Nueva Vacante' }}
      </h3>
      <button type="button" class="btn-close" (click)="onClose()">
        <span class="visually-hidden">Cerrar</span>
      </button>
    </div>

    <div class="modal-body">
      <!-- Loading -->
      <div *ngIf="loading" class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2 text-muted">
          {{ isEdit ? 'Actualizando vacante...' : 'Creando vacante...' }}
        </p>
      </div>

      <!-- Error -->
      <div *ngIf="error && !loading" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        {{ error }}
        <button type="button" class="btn-close" (click)="error = ''"></button>
      </div>

      <!-- Success -->
      <div *ngIf="success && !loading" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>
        {{ success }}
      </div>

      <!-- Información de empresa -->
      <!-- <div *ngIf="empresaId" class="alert alert-info mb-4">
        <i class="bi bi-building me-2"></i>
        <strong>Empresa:</strong> {{ getNombreEmpresa() }}
      </div> -->

      <div *ngIf="!empresaId" class="alert alert-warning mb-4">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <strong>Advertencia:</strong> No hay empresa seleccionada. La vacante se creará sin empresa asignada.
      </div>

      <form *ngIf="!loading" (ngSubmit)="onSubmit()" #vacanteForm="ngForm" class="vacante-form">
        <div class="form-sections">
          <!-- Información Básica -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="bi bi-info-circle me-2"></i>
              Información Básica
            </h4>
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">
                  <label for="titulo" class="form-label">Título del puesto *</label>
                  <input type="text" class="form-control" id="titulo"
                         [(ngModel)]="vacanteRequest.titulo" name="titulo"
                         required placeholder="Ej: Desarrollador Frontend">
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="descripcion" class="form-label">Descripción del puesto *</label>
              <textarea class="form-control" id="descripcion" rows="4"
                        [(ngModel)]="vacanteRequest.descripcion" name="descripcion"
                        required placeholder="Describe las responsabilidades y funciones del puesto..."></textarea>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="salario" class="form-label">Salario mensual *</label>
                  <input type="number" class="form-control" id="salario"
                         [(ngModel)]="vacanteRequest.salario" name="salario"
                         required min="0" step="0.01" placeholder="0.00">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="solicitudesPermitidas" class="form-label">Solicitudes permitidas *</label>
                  <input type="number" class="form-control" id="solicitudesPermitidas"
                         [(ngModel)]="vacanteRequest.solicitudesPermitidas" name="solicitudesPermitidas"
                         required min="1" placeholder="50">
                </div>
              </div>
            </div>
          </div>

          <!-- Detalles del Trabajo -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="bi bi-briefcase me-2"></i>
              Detalles del Trabajo
            </h4>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="areaId" class="form-label">Área profesional *</label>
                  <select class="form-select" id="areaId"
                          [(ngModel)]="vacanteRequest.areaId" name="areaId"
                          (change)="onAreaChange()" required>
                    <option value="">Seleccione un área</option>
                    <option *ngFor="let area of areas" [value]="area.id">{{ area.nombre }}</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="modalidadId" class="form-label">Modalidad de trabajo *</label>
                  <select class="form-select" id="modalidadId"
                          [(ngModel)]="vacanteRequest.modalidadId" name="modalidadId" required>
                    <option value="">Seleccione una modalidad</option>
                    <option *ngFor="let modalidad of modalidades" [value]="modalidad.id">
                      {{ modalidad.nombre }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="tipoContrato" class="form-label">Tipo de contrato *</label>
                  <input type="text" class="form-control" id="tipoContrato"
                         [(ngModel)]="vacanteRequest.tipoContrato" name="tipoContrato"
                         required placeholder="Ej: Tiempo completo, Indefinido">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="fechaExpiracion" class="form-label">Fecha de expiración *</label>
                  <input type="datetime-local" class="form-control" id="fechaExpiracion"
                         [(ngModel)]="vacanteRequest.fechaExpiracion" name="fechaExpiracion" required>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="beneficios" class="form-label">Beneficios adicionales</label>
              <textarea class="form-control" id="beneficios" rows="3"
                        [(ngModel)]="vacanteRequest.beneficios" name="beneficios"
                        placeholder="Seguro médico, vales de despensa, bonos, etc..."></textarea>
            </div>
          </div>

          <!-- Horario de Trabajo -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="bi bi-clock me-2"></i>
              Horario de Trabajo
            </h4>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="horaInicio" class="form-label">Hora de inicio</label>
                  <input type="time" class="form-control" id="horaInicio"
                         [(ngModel)]="vacanteRequest.horaInicio" name="horaInicio">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="horaFin" class="form-label">Hora de fin</label>
                  <input type="time" class="form-control" id="horaFin"
                         [(ngModel)]="vacanteRequest.horaFin" name="horaFin">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="horasPorSemana" class="form-label">Horas por semana</label>
                  <input type="number" class="form-control" id="horasPorSemana"
                         [(ngModel)]="vacanteRequest.horasPorSemana" name="horasPorSemana"
                         min="0" max="168" placeholder="40">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="diasLaborales" class="form-label">Días laborales</label>
                  <input type="text" class="form-control" id="diasLaborales"
                         [(ngModel)]="vacanteRequest.diasLaborales" name="diasLaborales"
                         placeholder="Ej: Lunes a Viernes">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="turno" class="form-label">Turno</label>
                  <select class="form-select" id="turno" [(ngModel)]="vacanteRequest.turno" name="turno">
                    <option value="">Seleccione un turno</option>
                    <option value="Matutino">Matutino</option>
                    <option value="Vespertino">Vespertino</option>
                    <option value="Nocturno">Nocturno</option>
                    <option value="Mixto">Mixto</option>
                    <option value="Flexible">Flexible</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="horarioFlexible"
                     [(ngModel)]="vacanteRequest.horarioFlexible" name="horarioFlexible">
              <label class="form-check-label" for="horarioFlexible">Horario flexible</label>
            </div>
          </div>

          <!-- Habilidades e Idiomas -->
          <div class="form-section">
            <div class="row">
              <div class="col-md-6">
                <h4 class="section-title">
                  <i class="bi bi-tools me-2"></i>
                  Habilidades Requeridas
                </h4>
                <div class="skills-container">
                  <div *ngIf="vacanteRequest.areaId && habilidadesFiltradas.length > 0" class="skills-list">
                    <div *ngFor="let habilidad of habilidadesFiltradas" class="skill-item">
                      <input type="checkbox" class="form-check-input"
                             [id]="'hab_' + habilidad.id"
                             [checked]="isHabilidadSelected(habilidad.id)"
                             (change)="toggleHabilidad(habilidad.id)">
                      <label class="form-check-label" [for]="'hab_' + habilidad.id">
                        {{ habilidad.nombre }}
                      </label>
                    </div>
                  </div>
                  <div *ngIf="!vacanteRequest.areaId" class="no-skills">
                    <i class="bi bi-info-circle"></i>
                    <p>Seleccione un área para ver las habilidades disponibles</p>
                  </div>
                  <div *ngIf="vacanteRequest.areaId && habilidadesFiltradas.length === 0" class="no-skills">
                    <i class="bi bi-exclamation-circle"></i>
                    <p>No hay habilidades disponibles para esta área</p>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <h4 class="section-title">
                  <i class="bi bi-translate me-2"></i>
                  Idiomas Requeridos
                </h4>
                <div class="skills-container">
                  <div *ngIf="idiomas.length > 0" class="skills-list">
                    <div *ngFor="let idioma of idiomas" class="skill-item">
                      <input type="checkbox" class="form-check-input"
                             [id]="'idioma_' + idioma.id"
                             [checked]="isIdiomaSelected(idioma.id)"
                             (change)="toggleIdioma(idioma.id)">
                      <label class="form-check-label" [for]="'idioma_' + idioma.id">
                        {{ idioma.idioma }}
                      </label>
                    </div>
                  </div>
                  <div *ngIf="idiomas.length === 0" class="no-skills">
                    <i class="bi bi-exclamation-circle"></i>
                    <p>No hay idiomas disponibles</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Botones de acción -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="loading">
            <i class="bi bi-x-circle me-2"></i>
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!vacanteForm.form.valid || loading">
            <i class="bi bi-check-circle me-2"></i>
            {{ isEdit ? 'Actualizar' : 'Crear' }} Vacante
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
